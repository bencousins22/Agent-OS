import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useEffect } from 'react';
import { collaboration } from '../services/collaboration';
import { Briefcase, Plus, Folder, Users, Activity, ExternalLink, X } from 'lucide-react';
import { shell } from '../services/shell';
import { bus } from '../services/eventBus';
export const ProjectView = () => {
    const [projects, setProjects] = useState([]);
    const [collaborators, setCollaborators] = useState([]);
    const [showNewModal, setShowNewModal] = useState(false);
    const [mobileTab, setMobileTab] = useState('projects');
    const [newName, setNewName] = useState('');
    const [newDesc, setNewDesc] = useState('');
    const [newStack, setNewStack] = useState([]);
    useEffect(() => {
        const refresh = () => { setProjects(collaboration.getProjects()); setCollaborators(collaboration.getCollaborators()); };
        refresh();
        const interval = setInterval(refresh, 1000);
        return () => clearInterval(interval);
    }, []);
    const handleCreate = () => {
        if (!newName)
            return;
        collaboration.createProject(newName, newDesc, newStack);
        setShowNewModal(false);
        setNewName('');
        setNewDesc('');
        setNewStack([]);
    };
    const openProject = async (path) => {
        bus.emit('switch-view', { view: 'code' });
        setTimeout(() => shell.execute(`cd ${path}`), 100);
    };
    return (_jsxs("div", { className: "h-full bg-os-bg flex flex-col overflow-hidden", children: [_jsxs("div", { className: "hidden md:flex p-4 md:p-6 border-b border-os-border bg-os-panel items-center justify-between shrink-0", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "bg-aussie-500/20 p-2 rounded-lg", children: _jsx(Briefcase, { className: "w-6 h-6 text-aussie-500" }) }), _jsx("div", { children: _jsx("h2", { className: "text-lg md:text-xl font-bold text-white", children: "Projects" }) })] }), _jsxs("button", { onClick: () => setShowNewModal(true), className: "px-4 py-2 bg-aussie-500 hover:bg-aussie-600 text-[#0f1216] rounded-lg font-bold flex items-center gap-2 shadow-lg text-xs md:text-sm active:scale-95 transition-transform", children: [_jsx(Plus, { className: "w-4 h-4" }), " New Project"] })] }), _jsxs("div", { className: "flex-1 flex flex-col md:flex-row min-h-0 relative", children: [_jsxs("div", { className: "md:hidden flex border-b border-os-border bg-os-panel shrink-0 sticky top-0 z-10", children: [_jsx("button", { onClick: () => setMobileTab('projects'), className: `flex-1 py-3 text-xs font-bold uppercase transition-colors ${mobileTab === 'projects' ? 'text-aussie-500 border-b-2 border-aussie-500 bg-white/5' : 'text-gray-500'}`, children: "Projects" }), _jsx("button", { onClick: () => setMobileTab('team'), className: `flex-1 py-3 text-xs font-bold uppercase transition-colors ${mobileTab === 'team' ? 'text-aussie-500 border-b-2 border-aussie-500 bg-white/5' : 'text-gray-500'}`, children: "Team" })] }), _jsxs("div", { className: `flex-1 p-4 md:p-6 overflow-y-auto pb-24 md:pb-6 ${mobileTab === 'team' ? 'hidden md:block' : 'block'}`, children: [_jsx("div", { className: "grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4", children: projects.map(project => (_jsxs("div", { onClick: () => openProject(project.path), className: "group bg-os-panel border border-os-border rounded-xl p-5 hover:border-aussie-500/50 transition-all hover:shadow-xl active:scale-[0.98] cursor-pointer", children: [_jsxs("div", { className: "flex justify-between items-start mb-3", children: [_jsx("div", { className: "bg-os-bg p-2 rounded-lg border border-os-border group-hover:border-aussie-500/30", children: _jsx(Folder, { className: "w-6 h-6 text-aussie-500" }) }), _jsx(ExternalLink, { className: "w-4 h-4 text-os-textDim" })] }), _jsx("h3", { className: "text-lg font-bold text-white mb-1", children: project.name }), _jsx("p", { className: "text-xs text-os-textDim mb-4 line-clamp-2", children: project.description }), _jsx("div", { className: "flex flex-wrap gap-2 mb-4", children: project.stack.map(t => _jsx("span", { className: "px-2 py-1 bg-os-bg border border-os-border rounded text-[10px] font-bold text-gray-300 uppercase", children: t }, t)) }), _jsxs("div", { className: "pt-4 border-t border-os-border flex justify-between text-xs text-os-textDim", children: [_jsx("span", { children: new Date(project.lastUpdated).toLocaleDateString() }), _jsx("div", { className: "flex -space-x-2", children: collaborators.slice(0, 3).map(c => _jsx("div", { className: "w-6 h-6 rounded-full border-2 border-os-panel flex items-center justify-center text-[8px] font-bold text-white", style: { backgroundColor: c.color }, children: c.avatar }, c.id)) })] })] }, project.id))) }), _jsx("button", { onClick: () => setShowNewModal(true), className: "md:hidden fixed bottom-24 right-6 w-14 h-14 bg-aussie-500 rounded-full shadow-2xl flex items-center justify-center z-20 active:scale-90 transition-transform border-2 border-[#0f1216]", children: _jsx(Plus, { className: "w-6 h-6 text-black" }) })] }), _jsxs("div", { className: `w-full md:w-80 bg-[#0f1115] border-l border-os-border flex-col shrink-0 ${mobileTab === 'projects' ? 'hidden md:flex' : 'flex'}`, children: [_jsxs("div", { className: "p-4 border-b border-os-border", children: [_jsxs("h3", { className: "text-xs font-bold text-os-textDim uppercase mb-3 flex items-center gap-2", children: [_jsx(Users, { className: "w-4 h-4" }), " Team"] }), _jsx("div", { className: "space-y-3", children: collaborators.map(u => _jsxs("div", { className: "flex items-center gap-3 p-2 rounded hover:bg-os-panel", children: [_jsxs("div", { className: "relative", children: [_jsx("div", { className: "w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white", style: { backgroundColor: u.color }, children: u.avatar }), _jsx("div", { className: `absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-[#0f1115] ${u.status === 'online' ? 'bg-green-500' : 'bg-gray-500'}` })] }), _jsxs("div", { children: [_jsx("div", { className: "text-sm font-bold text-gray-200", children: u.name }), _jsx("div", { className: "text-[10px] text-os-textDim uppercase", children: u.status })] })] }, u.id)) })] }), _jsxs("div", { className: "flex-1 p-4 overflow-y-auto pb-24 md:pb-4", children: [_jsxs("h3", { className: "text-xs font-bold text-os-textDim uppercase mb-3 flex items-center gap-2", children: [_jsx(Activity, { className: "w-4 h-4" }), " Activity"] }), _jsx("div", { className: "relative border-l border-os-border ml-1.5 pl-4 space-y-4", children: collaborators.filter(c => c.status === 'coding').map((u, i) => _jsxs("div", { children: [_jsx("div", { className: "text-xs font-bold text-gray-300", children: u.name }), _jsx("div", { className: "text-[11px] text-gray-500", children: "Editing main.tsx" })] }, i)) })] })] })] }), showNewModal && (_jsx("div", { className: "absolute inset-0 bg-black/60 backdrop-blur-sm flex items-end md:items-center justify-center z-50 md:p-4", onClick: () => setShowNewModal(false), children: _jsxs("div", { className: "bg-os-panel border-t md:border border-os-border rounded-t-2xl md:rounded-xl p-6 w-full max-w-[500px] shadow-2xl animate-in slide-in-from-bottom duration-300 pb-safe", onClick: e => e.stopPropagation(), children: [_jsxs("div", { className: "flex justify-between mb-6", children: [_jsx("h3", { className: "text-lg font-bold text-white", children: "New Workspace" }), _jsx("button", { onClick: () => setShowNewModal(false), children: _jsx(X, { className: "w-5 h-5 text-gray-500" }) })] }), _jsxs("div", { className: "space-y-4 mb-6", children: [_jsx("input", { value: newName, onChange: e => setNewName(e.target.value), className: "w-full bg-os-bg border border-os-border rounded-lg p-3 text-[16px] md:text-sm text-white outline-none focus:border-aussie-500", placeholder: "Project Name", autoFocus: true }), _jsx("textarea", { value: newDesc, onChange: e => setNewDesc(e.target.value), className: "w-full bg-os-bg border border-os-border rounded-lg p-3 text-[16px] md:text-sm text-white outline-none focus:border-aussie-500 h-20 resize-none", placeholder: "Description" }), _jsx("div", { className: "flex gap-2 flex-wrap", children: ['react', 'node', 'python'].map(t => _jsx("button", { onClick: () => setNewStack(prev => prev.includes(t) ? prev.filter(x => x !== t) : [...prev, t]), className: `px-3 py-2 rounded text-xs font-bold uppercase border ${newStack.includes(t) ? 'bg-aussie-500 text-black border-aussie-500' : 'bg-os-bg text-gray-400 border-os-border'}`, children: t }, t)) })] }), _jsx("button", { onClick: handleCreate, className: "w-full py-3 bg-aussie-500 text-black font-bold rounded-lg text-sm shadow-lg active:scale-95 transition-transform", children: "Create Project" })] }) }))] }));
};
