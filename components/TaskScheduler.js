import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useEffect } from 'react';
import { scheduler } from '../services/scheduler';
import { Plus, Trash2, Clock, Activity, Calendar, RefreshCw, Terminal } from 'lucide-react';
export const TaskScheduler = () => {
    const [tasks, setTasks] = useState([]);
    const [showForm, setShowForm] = useState(false);
    // Form State
    const [newName, setNewName] = useState('');
    const [newType, setNewType] = useState('command');
    const [newAction, setNewAction] = useState('');
    const [newSchedule, setNewSchedule] = useState('once');
    const [newInterval, setNewInterval] = useState(60);
    useEffect(() => {
        const interval = setInterval(() => {
            setTasks([...scheduler.getTasks()]);
        }, 1000);
        return () => clearInterval(interval);
    }, []);
    const handleAdd = () => {
        if (!newName || !newAction)
            return;
        scheduler.addTask({
            name: newName,
            type: newType,
            action: newAction,
            schedule: newSchedule,
            intervalSeconds: newSchedule === 'interval' ? newInterval : undefined,
            nextRun: Date.now() // Run immediately/soon
        });
        setShowForm(false);
        setNewName('');
        setNewAction('');
    };
    const handleDelete = (id) => {
        scheduler.removeTask(id);
    };
    return (_jsxs("div", { className: "h-full bg-[#0f1115] text-gray-300 flex flex-col", children: [_jsxs("div", { className: "p-4 md:p-6 border-b border-gray-800 bg-[#161b22] flex justify-between items-center sticky top-0 z-10", children: [_jsxs("div", { children: [_jsxs("h2", { className: "text-lg md:text-xl font-bold text-white flex items-center gap-2", children: [_jsx(Calendar, { className: "w-5 h-5 md:w-6 md:h-6 text-blue-400" }), _jsx("span", { className: "hidden md:inline", children: "Task Scheduler" }), _jsx("span", { className: "md:hidden", children: "Tasks" })] }), _jsx("p", { className: "text-xs md:text-sm text-gray-400", children: "Automate system operations" })] }), _jsxs("button", { onClick: () => setShowForm(true), className: "px-3 md:px-4 py-2 bg-aussie-500 hover:bg-aussie-600 text-[#0f1216] rounded-lg font-bold flex items-center gap-2 transition-colors shadow-lg shadow-aussie-500/20 text-sm", children: [_jsx(Plus, { className: "w-4 h-4" }), " New"] })] }), _jsxs("div", { className: "flex-1 p-4 md:p-6 overflow-y-auto", children: [showForm && (_jsxs("div", { className: "mb-6 p-4 bg-[#1c2128] border border-gray-700 rounded-xl animate-in slide-in-from-top duration-200", children: [_jsx("h3", { className: "font-bold text-white mb-4", children: "Create New Automated Task" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-4", children: [_jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-500 mb-1", children: "Task Name" }), _jsx("input", { value: newName, onChange: e => setNewName(e.target.value), className: "w-full bg-[#0d1117] border border-gray-700 rounded p-2 text-sm text-white outline-none focus:border-blue-500", placeholder: "e.g., Hourly System Scan" })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-500 mb-1", children: "Type" }), _jsxs("select", { value: newType, onChange: e => setNewType(e.target.value), className: "w-full bg-[#0d1117] border border-gray-700 rounded p-2 text-sm text-white outline-none", children: [_jsx("option", { value: "command", children: "Shell Command" }), _jsx("option", { value: "swarm", children: "Swarm Objective" })] })] }), _jsxs("div", { className: "col-span-1 md:col-span-2", children: [_jsx("label", { className: "block text-xs text-gray-500 mb-1", children: newType === 'command' ? 'Shell Command' : 'Swarm Objective' }), _jsx("input", { value: newAction, onChange: e => setNewAction(e.target.value), className: "w-full bg-[#0d1117] border border-gray-700 rounded p-2 text-sm text-white font-mono outline-none focus:border-blue-500", placeholder: newType === 'command' ? 'echo "Backup started" >> log.txt' : 'Analyze system logs and fix errors' })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-500 mb-1", children: "Frequency" }), _jsxs("select", { value: newSchedule, onChange: e => setNewSchedule(e.target.value), className: "w-full bg-[#0d1117] border border-gray-700 rounded p-2 text-sm text-white outline-none", children: [_jsx("option", { value: "once", children: "Run Once" }), _jsx("option", { value: "interval", children: "Recurring Interval" })] })] }), newSchedule === 'interval' && (_jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-500 mb-1", children: "Interval (Seconds)" }), _jsx("input", { type: "number", value: newInterval, onChange: e => setNewInterval(parseInt(e.target.value)), className: "w-full bg-[#0d1117] border border-gray-700 rounded p-2 text-sm text-white outline-none" })] }))] }), _jsxs("div", { className: "flex gap-2 justify-end", children: [_jsx("button", { onClick: () => setShowForm(false), className: "px-3 py-1.5 text-sm text-gray-400 hover:text-white", children: "Cancel" }), _jsx("button", { onClick: handleAdd, className: "px-3 py-1.5 bg-aussie-500 hover:bg-aussie-600 text-[#0f1216] rounded text-sm font-bold shadow-lg shadow-aussie-500/20", children: "Save Task" })] })] })), _jsxs("div", { className: "grid grid-cols-1 gap-4", children: [tasks.map(task => (_jsxs("div", { className: "bg-[#161b22] border border-gray-800 rounded-xl p-4 flex flex-col md:flex-row md:items-center gap-4 hover:border-gray-600 transition-colors", children: [_jsxs("div", { className: "flex items-center gap-3 md:gap-4 w-full md:w-auto", children: [_jsx("div", { className: `
                                    w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center shrink-0
                                    ${task.status === 'active' ? 'bg-blue-500/10 text-blue-400' : 'bg-gray-700/50 text-gray-500'}
                                `, children: task.type === 'swarm' ? _jsx(Activity, { className: "w-5 h-5 md:w-6 md:h-6" }) : _jsx(Terminal, { className: "w-5 h-5 md:w-6 md:h-6" }) }), _jsx("div", { className: "flex-1 min-w-0 md:hidden", children: _jsxs("div", { className: "flex items-center gap-2 mb-1", children: [_jsx("h3", { className: "font-bold text-white text-sm", children: task.name }), _jsx("span", { className: `text-[9px] px-1.5 py-0.5 rounded-full uppercase font-bold ${task.status === 'active' ? 'bg-green-500/20 text-green-400' : 'bg-gray-700 text-gray-400'}`, children: task.status })] }) }), _jsx("button", { onClick: () => handleDelete(task.id), className: "md:hidden p-2 text-gray-500 hover:text-red-400", children: _jsx(Trash2, { className: "w-4 h-4" }) })] }), _jsxs("div", { className: "flex-1 min-w-0", children: [_jsxs("div", { className: "hidden md:flex items-center gap-2 mb-1", children: [_jsx("h3", { className: "font-bold text-white", children: task.name }), _jsx("span", { className: `text-[10px] px-2 py-0.5 rounded-full uppercase font-bold ${task.status === 'active' ? 'bg-green-500/20 text-green-400' : 'bg-gray-700 text-gray-400'}`, children: task.status })] }), _jsx("div", { className: "text-xs text-gray-400 font-mono truncate mb-2", children: task.action }), _jsxs("div", { className: "flex items-center gap-4 text-xs text-gray-500", children: [_jsxs("span", { className: "flex items-center gap-1", children: [_jsx(RefreshCw, { className: "w-3 h-3" }), task.schedule === 'once' ? 'One-time' : `Every ${task.intervalSeconds}s`] }), _jsxs("span", { className: "flex items-center gap-1", children: [_jsx(Clock, { className: "w-3 h-3" }), "Next: ", task.status === 'completed' ? '-' : new Date(task.nextRun).toLocaleTimeString()] })] })] }), _jsxs("div", { className: "flex items-center justify-between md:justify-end md:w-[200px] gap-4 pt-2 md:pt-0 border-t border-gray-800 md:border-t-0", children: [_jsxs("div", { className: "text-left md:text-right", children: [_jsx("div", { className: "text-xs text-gray-500 mb-1", children: "Last Result" }), _jsx("div", { className: `text-xs truncate max-w-[120px] ${task.lastResult?.includes('Failed') ? 'text-red-400' : 'text-green-400'}`, children: task.lastResult || '-' })] }), _jsx("button", { onClick: () => handleDelete(task.id), className: "hidden md:block p-2 text-gray-500 hover:text-red-400 hover:bg-red-400/10 rounded transition-colors", children: _jsx(Trash2, { className: "w-5 h-5" }) })] })] }, task.id))), tasks.length === 0 && !showForm && (_jsxs("div", { className: "text-center py-12 text-gray-500", children: [_jsx(Clock, { className: "w-12 h-12 mx-auto mb-3 opacity-20" }), _jsx("p", { children: "No tasks scheduled." })] }))] })] })] }));
};
